# Daily Log - 2025-07-17

## Session Timeline

- **Start Time**: Morning session
- **Session Focus**: Semantic Title Generation Debugging & Pinecone Search Issues

## Major Accomplishments

### [1] Title Generator UI Debugging & Text Visibility Fixes

1. **Issue**: User unable to see text when typing in title generator pages - white text on white background
2. **Root Cause**: Input component had `bg-transparent` which caused text visibility issues
3. **Solution**: Added explicit text colors (`text-gray-900`) and background colors (`bg-white`) to all input fields
4. **Files Modified**:
   - `/app/title-generator/version1-minimal/page.tsx`
   - `/app/title-generator/version2-dashboard/page.tsx`
   - `/app/title-generator/version3-cards/page.tsx`
5. **Impact**: All three UI versions now have properly visible input text

### [2] Pinecone Search Investigation - No Results for Cooking Videos

1. **Discovery**: Title generator returning 0 patterns and 0 videos for "best cooking techniques"
2. **Database Analysis**:
   - Found 3,870 cooking/food-related videos from 287 channels
   - Major channels include: Epicurious, Ethan Chlebowski, Joshua Weissman
   - 265 cooking videos marked with embeddings in database
3. **Pinecone Investigation**:
   - Confirmed 122,259 vectors in Pinecone index
   - Embedding dimension correct (512)
   - BUT search returning 0 results even with 0.1 threshold
4. **Root Cause**: Vectors in Pinecone only have `embedding_version: "v1"` metadata - missing title, channel info, etc.
5. **Solution**: System correctly uses video IDs as Pinecone vector IDs, then fetches full data from Supabase

### [3] Search Threshold Optimization & Direct Testing

1. **Created Test Endpoints**:
   - `/api/test-pinecone/route.ts` - Basic connection test
   - `/api/test-pinecone-fetch/route.ts` - Vector structure analysis
   - `/api/test-search-direct/route.ts` - Direct search with debugging
   - `/app/test-search/page.tsx` - UI for testing searches
2. **Findings**: 
   - Pinecone returns matches but with lower scores (0.64, 0.62, 0.61)
   - Original threshold of 0.7 was too high
   - Lowered threshold to 0.4 in generate-titles endpoint
3. **Added Comprehensive Logging**: Throughout Pinecone service and API endpoints

### [4] Dark Mode Text Visibility Fixes

1. **Issue**: Test search page had invisible text in dark mode
2. **Solution**: Added dark mode classes to all text elements
3. **Pattern**: `text-gray-900 dark:text-gray-100` for proper visibility

## Key Learnings

1. **Pinecone Metadata**: Vectors don't need full metadata - system uses IDs to fetch from Supabase
2. **Similarity Thresholds**: Cooking concept scores around 0.6, not 0.7+
3. **Database Sync**: `pinecone_embedded` flag in database out of sync with actual Pinecone contents (57K vs 121K)
4. **Search Architecture**: Working correctly - Pinecone for similarity, Supabase for full data

## Next Steps

1. Continue investigating why so few cooking videos appear in semantic search
2. Consider reindexing videos with better metadata
3. Implement broader topic coverage beyond woodworking-heavy content

### [5] Debug Panel Implementation for Title Generator

1. **Request**: User wanted to see full search pipeline statistics and debugging info
2. **Solution**: Created comprehensive debug panel showing:
   - Processing timeline with step-by-step durations
   - Score distribution visualization
   - Top matching videos with similarity scores
   - Claude prompt and discovered patterns
   - Technical details (embedding model, dimensions, threshold)
3. **Features**:
   - Fixed bottom panel that can be collapsed/expanded
   - Real-time stats: videos found, threshold, processing time
   - Visual score distribution chart
   - Collapsible sections for Claude prompt and patterns
4. **Files Created/Modified**:
   - Created `/components/debug-panel.tsx` - New debug panel component
   - Modified `/app/api/youtube/patterns/generate-titles/route.ts` - Added debug data collection
   - Modified `/app/title-generator/page.tsx` - Integrated debug panel
5. **Impact**: Full visibility into search algorithm behavior and performance

### [6] Cost Tracking & Performance-Based Pattern Discovery

1. **Cost Tracking Added**: 
   - Real-time API cost calculation in debug panel
   - OpenAI embeddings: $0.02/1M tokens
   - Claude 3.5 Sonnet: $3/1M input, $15/1M output tokens
   - Total cost per request: ~$0.021-0.025

2. **Performance-Based Video Selection**:
   - Leverages existing `performance_ratio` from database
   - Three-tier system: Superstar (10x+), Strong (3-10x), Above Avg (1.5-3x)
   - Stratified sampling ensures diverse high-performing patterns

3. **Query Expansion Implementation**:
   - GPT-4o-mini expands single concept → 6-8 related queries
   - Parallel search across all queries finds 5-10x more videos
   - Deduplication keeps highest similarity scores
   - Gathers up to 500 unique videos (vs 100 before)

4. **Files Modified**:
   - `/app/api/youtube/patterns/generate-titles/route.ts` - Major refactor for multi-query search
   - `/components/debug-panel.tsx` - Added cost breakdown display

## Technical Details

- Pinecone index: 122,259 vectors with 512 dimensions
- Similarity scores for "best cooking techniques": 0.64 (Epicurious), 0.62 (Ethan Chlebowski)
- API changes: Threshold lowered 0.7 → 0.3, added multi-query expansion
- Debug panel shows: embedding → search → pattern discovery → title generation + costs
- Performance tiers: Superstar (10x+), Strong (3-10x), Above Avg (1.5-3x) channel average

*Session Status: Enhanced Title Generator - Performance-Based Pattern Discovery with Cost Tracking*